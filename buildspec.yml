version: 0.2

phases:
  build:
    commands:
      - echo Build started on date
      
      # Create build-output directory and add files
      - mkdir -p build-output
      - cp index.html build-output/
      - mkdir -p build-output/scripts
      - cp scripts/install_nginx.sh build-output/scripts/
      - cp scripts/start_nginx.sh build-output/scripts/
      - cp appspec.yml build-output/
      - cp buildspec.yml build-output/
      
      # Create the ZIP file with build outputs
      - cd build-output
      - zip -r ../build-output.zip .
      - cd ..
      
      # Extract the ZIP file to the required directory
      - mkdir -p /opt/codedeploy-agent/deployment-root/05817a5f-bdfb-4b75-b64b-1be2f1a6983e/d-6XCY0YLI6/deployment-archive
      - unzip build-output.zip -d /opt/codedeploy-agent/deployment-root/05817a5f-bdfb-4b75-b64b-1be2f1a6983e/d-6XCY0YLI6/deployment-archive
      
artifacts:
  files:
    - build-output.zip
